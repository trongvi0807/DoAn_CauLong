@model IEnumerable<DoAn_CauLong.Models.DonHang>
@{
    ViewBag.Title = "Đơn hàng của tôi";
}

<div class="container" style="padding: 20px;">
    <h2>Đơn hàng của tôi</h2>
    <hr />

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (!Model.Any())
    {
        <div class="alert alert-info">Bạn chưa có đơn hàng nào.</div>
    }
    else
    {
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Mã Đơn</th>
                    <th>Ngày Đặt</th>
                    <th>Người Đặt</th>
                    <th>Địa chỉ</th>
                    <th>Tổng tiền</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    <tr>
                        <td>#@order.MaDonHang</td>
                        <td>@(order.NgayDat?.ToString("dd/MM/yyyy HH:mm"))</td>
                        <td>@order.KhachHang.HoTen</td>
                        <td>@order.DiaChiGiaoHang</td>
                        <td>@(order.TongTien?.ToString("N0"))đ</td>
                        <td>
                            @if (order.TrangThai == "Chờ xác nhận")
                            {
                                <span class="label label-warning">@order.TrangThai</span>
                            }
                            else if (order.TrangThai == "Đã xử lý" || order.TrangThai == "Đã thanh toán bằng MoMo")
                            {
                                <span class="label label-success">@order.TrangThai</span>
                            }
                            else if (order.TrangThai.Contains("Đã hủy"))
                            {
                                <span class="label label-danger">@order.TrangThai</span>
                            }
                            else
                            {
                                <span class="label label-default">@order.TrangThai</span>
                            }
                        </td>
                        <td>
                            @Html.ActionLink("Xem Chi tiết", "Details", "DonHang", new { id = order.MaDonHang }, new { @class = "btn btn-info btn-sm" })

                            @if (order.TrangThai == "Chờ xác nhận")
                            {
                                // Vì Controller yêu cầu HttpPost và ValidateAntiForgeryToken nên phải dùng Form
                                using (Html.BeginForm("HuyDonHang", "DonHang", new { id = order.MaDonHang }, FormMethod.Post, new { style = "display:inline;", onsubmit = "return confirm('Bạn có chắc chắn muốn hủy đơn hàng này không?');" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-danger btn-sm" style="margin-left: 5px;">Hủy đơn</button>
                                }
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>