@* Giả định Model của bạn là DoAn_CauLong.Models.SanPham và đã được Include các bảng liên quan *@
@model DoAn_CauLong.Models.SanPham

@{
    ViewBag.Title = "Chi Tiết Sản Phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@* Hiển thị tên sản phẩm trên tiêu đề cho rõ ràng *@
<h2>Chi Tiết: @Html.DisplayFor(model => model.TenSanPham)</h2>

<div>
    <h4>Thông Tin Chung Của Sản Phẩm</h4>
    <hr />

    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.TenSanPham)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.TenSanPham)
        </dd>

        <dt>
            Ảnh Đại Diện
        </dt>
        <dd>
            @* SỬA: Tên thuộc tính "Anh" -> "HinhAnhDaiDien" *@
            @if (!string.IsNullOrEmpty(Model.HinhAnhDaiDien))
            {
                @* Lưu ý: Điều chỉnh đường dẫn ảnh cho đúng với project của bạn *@
                <img src="@Url.Content("~/Content/Images/" + Model.HinhAnhDaiDien)" width="250" alt="@Model.TenSanPham" />
            }
            else
            {
                <span>(Không có ảnh)</span>
            }
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.MoTa)
        </dt>
        <dd>
            @* Dùng @Html.Raw để hiển thị HTML nếu mô tả có định dạng *@
            @Html.Raw(Model.MoTa)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.GiaGoc)
        </dt>
        <dd>
            @* SỬA: "GiaBan" -> "GiaGoc". Định dạng tiền tệ *@
            @Model.GiaGoc.GetValueOrDefault(0m).ToString("N0") VNĐ
        </dd>

        <dt>
            Hãng Sản Xuất
        </dt>
        <dd>
            @* THÊM MỚI: Hiển thị Hãng (từ SQL) *@
            @Html.DisplayFor(model => model.Hang.TenHang)
        </dd>

        <dt>
            Loại Sản Phẩm
        </dt>
        <dd>
            @* SỬA: "THELOAI.TenTheLoai" -> "LoaiSanPham.TenLoai" *@
            @Html.DisplayFor(model => model.LoaiSanPham.TenLoai)
        </dd>

        <dt>
            Nhà Cung Cấp
        </dt>
        <dd>
            @* SỬA: "NHACUNGCAP.TenNCC" -> "NhaCungCap.TenNhaCungCap" *@
            @Html.DisplayFor(model => model.NhaCungCap.TenNhaCungCap)
        </dd>

        <dt>
            Khuyến Mãi
        </dt>
        <dd>
            @* THÊM MỚI: Hiển thị Khuyến mãi (nếu có) *@
            @(Model.KhuyenMai != null ? Model.KhuyenMai.TenChuongTrinh : "Không áp dụng")
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.NgayTao)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.NgayTao)
        </dd>

        @* XÓA: Bỏ GiaBan và SoLuong khỏi phần chung này *@
    </dl>
</div>
<hr />

<h4>Các Biến Thể Chi Tiết (Giá Bán và Tồn Kho)</h4>

@if (Model.ChiTietSanPhams != null && Model.ChiTietSanPhams.Any())
{
    <table class="table table-striped table-bordered">
        <tr class="success">
            <th>SKU</th>
            <th>Màu Sắc</th>
            <th>Size</th>
            <th>Giá Bán</th>
            <th>Số Lượng Tồn</th>
            <th></th>
        </tr>

        @foreach (var item in Model.ChiTietSanPhams)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.SKU)
                </td>
                <td>
                    @* Kiểm tra null cho các thuộc tính liên kết *@
                    @(item.MauSac != null ? item.MauSac.TenMau : "N/A")
                </td>
                <td>
                    @(item.Size != null ? item.Size.TenSize : "N/A")
                </td>
                <td>
                    @(Model.GiaGoc?.ToString("N0")) VNĐ
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SoLuongTon)
                </td>
                <td>
                    @* Thêm link để Sửa/Xóa từng Chi Tiết *@
                    @Html.ActionLink("Sửa", "EditChiTiet", "QuanLySanPham", new { id = item.MaChiTiet }, null) |
                    @Html.ActionLink("Xóa", "DeleteChiTiet", "QuanLySanPham", new { id = item.MaChiTiet }, null)
                </td>
            </tr>
        }
    </table>
}
else
{
    <div class="alert alert-warning">Sản phẩm này chưa có chi tiết (Màu/Size/Giá bán). Hãy thêm chi tiết.</div>
}

<p>
    @* SỬA: Tên thuộc tính "MaSP" -> "MaSanPham" *@
    @Html.ActionLink("Sửa Thông Tin Chung", "Edit", new { id = Model.MaSanPham }, new { @class = "btn btn-primary" }) |
    @Html.ActionLink("Quay lại Danh sách", "Index")
</p>