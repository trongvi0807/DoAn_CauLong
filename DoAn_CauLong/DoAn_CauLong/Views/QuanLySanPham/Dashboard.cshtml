@model DoAn_CauLong.ViewModels.AdminDashboardViewModel
@{
    ViewBag.Title = "Dashboard Admin";
}

<h1>Dashboard Admin</h1>

<hr />

<!-- 1. Biểu đồ doanh thu theo tháng -->
<h3>Doanh thu theo tháng</h3>
<canvas id="doanhThuThangChart" width="800" height="400"></canvas>

<!-- 2. Biểu đồ doanh thu theo quý -->
<h3>Doanh thu theo quý</h3>
<canvas id="doanhThuQuyChart" width="800" height="400"></canvas>

<hr />

<!-- 3. Thống kê doanh thu theo năm -->
<h3>Doanh thu theo năm</h3>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Năm</th>
            <th>Tổng doanh thu (VND)</th>
            <th>Số lượng đơn hàng</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.DoanhThuNam)
        {
            <tr>
                <td>@item.Nam</td>
                <td>@item.TongDoanhThu.ToString("N0")</td>
                <td>@item.SoLuongDon</td>
            </tr>
        }

    </tbody>
</table>

<hr />

<!-- 4. Thống kê sản phẩm bán chạy -->
<h3>Sản phẩm bán chạy</h3>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Tên sản phẩm</th>
            <th>Số lượng bán</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var sp in Model.SanPhamBanChay)
        {
            <tr>
                <td>@sp.TenSanPham</td>
                <td>@sp.TongSoLuongBan</td>
            </tr>
        }
    </tbody>
</table>

<!-- 5. Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Biểu đồ doanh thu theo tháng
    var ctxThang = document.getElementById('doanhThuThangChart').getContext('2d');
  var thangLabels = @Html.Raw(Json.Encode(Model.DoanhThuThang.Select(d => d.Thang)));
var thangData = @Html.Raw(Json.Encode(Model.DoanhThuThang.Select(d => d.TongDoanhThu)));



    new Chart(ctxThang, {
        type: 'bar',
        data: {
            labels: thangLabels,
            datasets: [{
                label: 'Doanh thu (VND)',
                data: thangData,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } },
            plugins: {
                legend: { display: false },
                title: { display: true, text: 'Doanh thu theo tháng' }
            }
        }
    });

    // Biểu đồ doanh thu theo quý
    var ctxQuy = document.getElementById('doanhThuQuyChart').getContext('2d');
   var quyLabels = @Html.Raw(Json.Encode(Model.DoanhThuQuy.Select(d => "Q" + d.Quy)));
var quyData = @Html.Raw(Json.Encode(Model.DoanhThuQuy.Select(d => d.TongDoanhThu)));


    new Chart(ctxQuy, {
        type: 'bar',
        data: {
            labels: quyLabels,
            datasets: [{
                label: 'Doanh thu (VND)',
                data: quyData,
                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } },
            plugins: {
                legend: { display: false },
                title: { display: true, text: 'Doanh thu theo quý' }
            }
        }
    });
</script>

<style>
    h3 {
        margin-top: 30px;
    }

    table {
        width: 100%;
        margin-bottom: 30px;
    }

    .table th, .table td {
        text-align: center;
    }
</style>
